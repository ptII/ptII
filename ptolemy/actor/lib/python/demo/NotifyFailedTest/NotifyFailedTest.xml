<?xml version="1.0" standalone="no"?>
<!DOCTYPE entity PUBLIC "-//UC Berkeley//DTD MoML 1//EN"
    "http://ptolemy.eecs.berkeley.edu/xml/dtd/MoML_1.dtd">
<entity name="notifyFailedTest" class="ptolemy.actor.TypedCompositeActor">
    <property name="SDF Director" class="ptolemy.domains.sdf.kernel.SDFDirector">
        <property name="Scheduler" class="ptolemy.domains.sdf.kernel.SDFScheduler">
        </property>
        <property name="allowDisconnectedGraphs" class="ptolemy.data.expr.Parameter" value="false">
        </property>
        <property name="iterations" class="ptolemy.data.expr.Parameter" value="10">
        </property>
        <property name="vectorizationFactor" class="ptolemy.data.expr.Parameter" value="1">
        </property>
        <property name="_location" class="ptolemy.kernel.util.Location" value="120.0, 195.0">
        </property>
    </property>
    <property name="_windowProperties" class="ptolemy.actor.gui.WindowPropertiesAttribute" value="{bounds={117, 12, 868, 493}}">
    </property>
    <property name="_vergilSize" class="ptolemy.actor.gui.SizeAttribute" value="[653, 377]">
    </property>
    <property name="annotation" class="ptolemy.kernel.util.Attribute">
        <property name="_hideName" class="ptolemy.kernel.util.SingletonAttribute">
        </property>
        <property name="_iconDescription" class="ptolemy.kernel.util.SingletonConfigurableAttribute">
            <configure><svg><text x="20" y="20" style="font-size:14; font-family:SansSerif; fill:blue">This is a demonstration of the PythonScript actor.
Jython (http://www.jython.org/), a Java implementation
of Python, is required to run this demo.

The script implements a limited test actor (only one
input channel is checked). When the test fails, an
email notification is sent, using the smtplib module
that is included in the standard Jython distribution.

To run the demo, set the SMTPServer to one that will
relay emails with the fromAddress for the local host.
Set fromAddress and toAddress accordingly.
</text></svg></configure>
        </property>
        <property name="_smallIconDescription" class="ptolemy.kernel.util.SingletonConfigurableAttribute">
            <configure>
      <svg>
        <text x="20" style="font-size:14; font-family:SansSerif; fill:blue" y="20">-A-</text>
      </svg>
    </configure>
        </property>
        <property name="_controllerFactory" class="ptolemy.vergil.basic.NodeControllerFactory">
        </property>
        <property name="_editorFactory" class="ptolemy.vergil.toolbox.AnnotationEditorFactory">
        </property>
        <property name="_location" class="ptolemy.kernel.util.Location" value="255.0, 10.0">
        </property>
    </property>
    <property name="SMTPServer" class="ptolemy.data.expr.Parameter" value="&quot;smtp.somewhere&quot;">
        <property name="_hideName" class="ptolemy.kernel.util.SingletonAttribute">
        </property>
        <property name="_icon" class="ptolemy.vergil.icon.ValueIcon">
        </property>
        <property name="_smallIconDescription" class="ptolemy.kernel.util.SingletonConfigurableAttribute">
            <configure>
      <svg>
        <text x="20" style="font-size:14; font-family:SansSerif; fill:blue" y="20">-P-</text>
      </svg>
    </configure>
        </property>
        <property name="_editorFactory" class="ptolemy.vergil.toolbox.VisibleParameterEditorFactory">
        </property>
        <property name="_location" class="ptolemy.kernel.util.Location" value="30.0, 30.0">
        </property>
    </property>
    <property name="fromAddress" class="ptolemy.data.expr.Parameter" value="&quot;someone@somewhere&quot;">
        <property name="_hideName" class="ptolemy.kernel.util.SingletonAttribute">
        </property>
        <property name="_icon" class="ptolemy.vergil.icon.ValueIcon">
        </property>
        <property name="_smallIconDescription" class="ptolemy.kernel.util.SingletonConfigurableAttribute">
            <configure>
      <svg>
        <text x="20" style="font-size:14; font-family:SansSerif; fill:blue" y="20">-P-</text>
      </svg>
    </configure>
        </property>
        <property name="_editorFactory" class="ptolemy.vergil.toolbox.VisibleParameterEditorFactory">
        </property>
        <property name="_location" class="ptolemy.kernel.util.Location" value="30.0, 55.0">
        </property>
    </property>
    <property name="toAddress" class="ptolemy.data.expr.Parameter" value="&quot;someone@somewhere&quot;">
        <property name="_hideName" class="ptolemy.kernel.util.SingletonAttribute">
        </property>
        <property name="_icon" class="ptolemy.vergil.icon.ValueIcon">
        </property>
        <property name="_smallIconDescription" class="ptolemy.kernel.util.SingletonConfigurableAttribute">
            <configure>
      <svg>
        <text x="20" style="font-size:14; font-family:SansSerif; fill:blue" y="20">-P-</text>
      </svg>
    </configure>
        </property>
        <property name="_editorFactory" class="ptolemy.vergil.toolbox.VisibleParameterEditorFactory">
        </property>
        <property name="_location" class="ptolemy.kernel.util.Location" value="30.0, 80.0">
        </property>
    </property>
    <entity name="Ramp" class="ptolemy.actor.lib.Ramp">
        <property name="firingCountLimit" class="ptolemy.data.expr.Parameter" value="0">
        </property>
        <property name="init" class="ptolemy.data.expr.Parameter" value="0">
        </property>
        <property name="step" class="ptolemy.actor.parameters.PortParameter" value="1">
        </property>
        <doc>Create a sequence of tokens with increasing value</doc>
        <property name="_location" class="ptolemy.kernel.util.Location" value="65.0, 295.0">
        </property>
        <port name="output" class="ptolemy.actor.TypedIOPort">
            <property name="output"/>
        </port>
        <port name="trigger" class="ptolemy.actor.TypedIOPort">
            <property name="input"/>
            <property name="multiport"/>
        </port>
        <port name="step" class="ptolemy.actor.parameters.ParameterPort">
            <property name="input"/>
        </port>
    </entity>
    <entity name="PythonActor - email test failure" class="ptolemy.actor.lib.python.PythonScript">
        <property name="script" class="ptolemy.kernel.util.StringAttribute" value="# A test actor that sends email&#10;# notification on test failure&#10;&#10;from smtplib import SMTP&#10;from ptolemy.data import BooleanToken&#10;&#10;class Main:&#10;  &quot;email test failure&quot;&#10;&#10;  # required parameters&#10;  # correctValues, tolerance,&#10;  # SMTPServer, fromAddress, toAddress&#10;&#10;  # required ports&#10;  # input, type general&#10;  # output, type boolean&#10;&#10;  numInput = 0&#10;  tol = 1.0&#10;&#10;  def preinitialize(self):&#10;    self.numInput = 0&#10;    self.tol = self.tolerance.getToken().doubleValue()&#10;&#10;  def fire(self):&#10;    v = self.input.get(0)&#10;&#10;    if self.correctValues.getToken().length() \&#10;        &lt;= self.numInput :&#10;      self.output.send(0, BooleanToken.TRUE);&#10;      return&#10;&#10;    refVals = self.correctValues.getToken()&#10;    refV = refVals.getElement(self.numInput)&#10;    t = v.isCloseTo(refV, self.tol)&#10;    self.output.send(0, t)&#10;&#10;    if not t.booleanValue() :&#10;      msg = &quot;Test fails in iteration &quot; \&#10;          + str(self.numInput) \&#10;          + &quot;.\r\n&quot; \&#10;          + &quot;Value was: &quot; + v.toString() \&#10;          + &quot;. Should have been: &quot; + refV.toString()&#10;      self.notify(msg)&#10;      raise msg&#10;    self.numInput = self.numInput + 1&#10;&#10;  def notify(self, msg):&#10;    server = SMTP(self.SMTPServer.getToken().stringValue())&#10;    server.sendmail( \&#10;        self.fromAddress.getToken().stringValue(), \&#10;        self.toAddress.getToken().stringValue(), \&#10;        &quot;Subject: Test failed\r\n&quot; \&#10;        + &quot;In actor &quot; + self.actor.getFullName() \&#10;        + &quot;:\r\n&quot; + msg + &quot;\r\n&quot;)&#10;    server.quit()&#10;">
            <property name="style" class="ptolemy.actor.gui.style.TextStyle">
            </property>
        </property>
        <property name="_tableauFactory" class="ptolemy.vergil.toolbox.TextEditorTableauFactory">
            <property name="attributeName" value="script"/>
        </property>     
        <property name="_location" class="ptolemy.kernel.util.Location" value="215.0, 295.0">
        </property>
        <property name="correctValues" class="ptolemy.data.expr.Parameter" value="{0, 1, 2, 4}">
        </property>
        <property name="tolerance" class="ptolemy.data.expr.Parameter" value="1.0E-9">
        </property>
        <property name="SMTPServer" class="ptolemy.data.expr.Parameter" value="SMTPServer">
        </property>
        <property name="fromAddress" class="ptolemy.data.expr.Parameter" value="fromAddress">
        </property>
        <property name="toAddress" class="ptolemy.data.expr.Parameter" value="toAddress">
        </property>
        <port name="input" class="ptolemy.actor.TypedIOPort">
            <property name="input"/>
        </port>
        <port name="output" class="ptolemy.actor.TypedIOPort">
            <property name="output"/>
            <property name="_type" class="ptolemy.actor.TypeAttribute" value="boolean">
            </property>
        </port>
    </entity>
    <entity name="Display" class="ptolemy.actor.lib.gui.Display">
        <property name="rowsDisplayed" class="ptolemy.data.expr.Parameter" value="10">
        </property>
        <property name="columnsDisplayed" class="ptolemy.data.expr.Parameter" value="40">
        </property>
        <property name="title" class="ptolemy.kernel.util.StringAttribute">
        </property>
        <property name="_windowProperties" class="ptolemy.actor.gui.WindowPropertiesAttribute">
        </property>
        <property name="_location" class="ptolemy.kernel.util.Location" value="445.0, 295.0">
        </property>
        <port name="input" class="ptolemy.actor.TypedIOPort">
            <property name="input"/>
            <property name="multiport"/>
        </port>
    </entity>
    <relation name="relation" class="ptolemy.actor.TypedIORelation">
    </relation>
    <relation name="relation2" class="ptolemy.actor.TypedIORelation">
    </relation>
    <link port="Ramp.output" relation="relation"/>
    <link port="PythonActor - email test failure.input" relation="relation"/>
    <link port="PythonActor - email test failure.output" relation="relation2"/>
    <link port="Display.input" relation="relation2"/>
</entity>
