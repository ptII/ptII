<!-- $Id$ -->
<html>
<head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<title>Ptolemy II</title>
<link href="../../../doc/default.css" rel="stylesheet" type="text/css">
</head>
<body>
<h1>HSIF To MoML</h1>
<P>
The Hybrid System Interchange Format (HSIF), was developed by the
<a href="http://www.isis.vanderbilt.edu#in_browser">Institute of Software Integrated Systems (ISIS) at Vanderbilt University</a>
as part of the <a href="http://www.isis.vanderbilt.edu/Projects/mobies/default.html#in_browser">ISIS MoBIES</a> effort.
The HSIF documentation states:

<blockquote>
"The goal of HSIF is to define an interchange format for hybrid system
models that can be shared between modeling and analysis tools. HSIF
models represent dynamic systems, whose dynamics includes both
continuous and discrete behaviors."
</blockquote>

Haiyang Zheng developed a set of XSLT files that convert
HSIF into MoML, the XML format used to represent Ptolemy II Models.

<h2>Models</h2>
To run the HSIF models, either use HyVisual or invoke vergil with the
<code>-hyvisual</code> flag so that the HSIF configuration is used.
If HyVisual or vergil is properly configured, then when an HSIF file
is opened, it is converted to a MoML file with a similar name, and then
the MoML file is opened displayed.  Note that typically there is no
layout information in an HSIF file, so the model components all get
rendered at location (0, 0), which is the upper left corner of the window.
You can improve the layout by selecting
<code>Automatic Layout</code> from the <code>Graph</code> menu.
<p>
There are two examples provided:
<ul>
<li> <a href="Thermostat/Thermostat.xml"><CODE>Thermostat.xml</CODE></a>
 - an HSIF file that gets converted to <CODE>Thermostat_moml.xml</CODE>
and opened.
<li> <a href="SwimmingPool/SwimmingPool.xml"><CODE>SwimmingPool.xml</CODE></a>
 - an HSIF file that gets converted to <CODE>SwimmingPool_moml.xml</CODE>
and opened.

<br>Note that to create a more complete simulation (and a better
looking plot), adjust the <i>stopTime</i> parameter of the CT
Director to <code>400.0</code> by double clicking on the
green CT Director icon.

<br>It may also be necessary to adjust the <i>maximumStepSize</i>
parameter from <code>0.3</code> to <code>1.0</code>
to accelerate the simulation process

</ul>

<h2>How it works</h2>
HyVisual and <code>vergil -hyvisual</code> both add the 
the HSIFEffigyFactory class to the list of EffigyFactories before
the standard Ptolemy Effigy so that when an XML file is opened.
HSIFEffigyFactory first checks to see whether the file is an HSIF file
by examining the header information.
If the file is not an HSIF file, then HSIFEffigyFactory refuses to
open the file. If the XML file is a MoML file, then it will be opened
by the standard PtolemyEffigy factory.
If the file is an HSIF file, then we convert the file
to MoML by running a series of XSL transformations on it.
<!-- a list of the different transformations would be useful -->
If the HSIF file is named <code><i>foo.xml<i></code>, then the MoML file
will be named as <code><i>foo</i></code> followed by some random number and
saved as a temporary file under the user's home directory. The user
may rename the MoML file and save it to a desired directory by selecting
<code> SaveAs </code> from the <code>File</code> menu.
</body>
</html>
