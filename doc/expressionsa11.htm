<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<!-- Generated from latex, don't update this file, update -->
<!-- ptIIdoc/doc/design/src/tex/expression.tex -->

<meta name="LASTUPDATED" content="$Id$">
<link href="default.css" rel="stylesheet" type="text/css">
<title>11 Fixed Point Numbers</title>
</head>

<body link="#3366CC" vlink="#9999CC" text="#000000" alink="#0000CC" bgcolor="#FFFFFF"


<table width="331" border="0" align="right" cellpadding="0" cellspacing="0">
  <tr>
    <td><a href="expressions.htm"><img src="img/navtoc.gif" width="84" height="23"
    border="0" alt="TOC"> </a></td>
    <td><a href="expressionsa10.htm"><img src="img/navprev.gif" width="81" height="23"
    border="0" alt="PREV"> </a></td>
    <td><a href="expressionsa12.htm"><img src="img/navnext.gif" width="81" height="23"
    border="0" alt="NEXT"> </a></td>

    
  </tr>
</table>




<blockquote>

<div class="p"><!----></div>
 <h2><a name="tth_sEc11">
11</a>&nbsp;&nbsp;Fixed Point Numbers</h2>
<a name="52338">
</a>
Ptolemy II includes a preliminary  fixed
point data type. We represent a fixed point value in the expression
language using the following format:

<pre>
fix(value,&nbsp;totalBits,&nbsp;integerBits)

</pre>
Thus, a fixed point value of 5.375 that uses 8 bit precision of which
4 bits are used to represent the (signed) integer part can be
represented as:

<pre>
fix(5.375,&nbsp;8,&nbsp;4)

</pre>
The value can also be a matrix of doubles. The values are rounded,
yielding the nearest value representable with the specified
precision. If the value to represent is out of range, then it is
saturated, meaning that the maximum or minimum fixed point value is
returned, depending on the sign of the specified value. For example,

<pre>
fix(5.375,&nbsp;8,&nbsp;3)

</pre>
will yield 3.968758, the maximum value possible with the (8/3) precision.

<div class="p"><!----></div>
In addition to the fix() function, the expression language offers a
 quantize()
function. The arguments are the same as those of the fix() function,
but the return type is a DoubleToken or DoubleMatrixToken instead of a
FixToken or FixMatrixToken. This function can therefore be used to
quantize double-precision values without ever explicitly working with
the fixed-point representation.

<div class="p"><!----></div>
To make the FixToken accessible within the expression language, the
following functions are available:

<ul>
<li>To create a single FixPoint Token using the expression language:

<pre>
fix(5.34,&nbsp;10,&nbsp;4)

</pre>
 This will create a FixToken. In this case, we try to fit the
number 5.34 into a 10 bit representation with 4 bits used in the
integer part. This may lead to quantization errors. By default the
round quantizer is used.
<div class="p"><!----></div>
</li>

<li> To create a Matrix with FixPoint values using the expression
  language:

<pre>
fix([&nbsp;-.040609,&nbsp;-.001628,&nbsp;.17853&nbsp;],&nbsp;10,&nbsp;2)&nbsp;

</pre>
 This will create a FixMatrixToken with 1 row and 3 columns, in
which each element is a FixPoint value with precision(10/2). The
resulting FixMatrixToken will try to fit each element of the given
<em>double</em> matrix into a 10 bit representation with 2 bits used for
the integer part. By default the round quantizer is used.
<div class="p"><!----></div>
</li>

<li> To create a single DoubleToken, which is the quantized version
  of the <em>double</em> value given, using the expression language:

<pre>
quantize(5.34,&nbsp;10,&nbsp;4)

</pre>
  This will create a DoubleToken. The resulting DoubleToken contains
  the <em>double</em> value obtained by fitting the number 5.34 into a
  10 bit representation with 4 bits used in the integer part. This may
  lead to quantization errors. By default the round quantizer is used.
<div class="p"><!----></div>
</li>

<li> To create a Matrix with doubles quantized to a particular
  precision using the expression language:

<pre>
quantize([&nbsp;-.040609,&nbsp;-.001628,&nbsp;.17853&nbsp;],&nbsp;10,&nbsp;2)&nbsp;

</pre>
   This will create a DoubleMatrixToken with 1 row and 3
  columns. The elements of the token are obtained by fitting the given
  matrix elements into a 10 bit representation with 2 bits used for
  the integer part. Instead of being a fixed point value, the values
  are converted back to their <em>double</em> representation and by
  default the round quantizer is used.
<div class="p"><!----></div>
</li>
</ul>

</blockquote>
<table width="331" border="0" cellpadding="0" cellspacing="0">
<tr>
  <td><a href="expressions.htm"><img src="img/navtoc.gif" width="84" height="23" border="0"
  alt="TOC"> </a></td>
  <td><a href="expressionsa10.htm"><img src="img/navprev.gif" width="81" height="23" border="0"
  alt="PREV"> </a></td>
  <td><a href="expressionsa12.htm"><img src="img/navnext.gif" width="81" height="23" border="0"
  alt="NEXT"> </a></td>


</tr>
</table>

</body>
</html>
